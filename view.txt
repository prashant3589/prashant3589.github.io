$conflict = $allowedState | Where-Object { $restrictedState -contains $_ }

if ($conflict.Count -gt 0) {
    throw "Invalid configuration. These states are both allowed and restricted: $($conflict -join ', ')"
}




- task: PowerShell@2
  displayName: "Commit Flyway migration scripts"
  inputs:
    targetType: inline
    script: |
      cd "$(Build.SourcesDirectory)"

      git status

      git add db/**/sql/*.sql

      # Check if there is anything to commit
      $changes = git status --porcelain
      if (-not $changes) {
        Write-Host "No migration changes to commit"
        exit 0
      }

      git config user.email "ado-pipeline@company.com"
      git config user.name "Azure DevOps Pipeline"

      git commit -m "Auto-generated Flyway migration from pipeline $(Build.BuildNumber)"
      git push origin HEAD:$(Build.SourceBranchName)
