- script: |
    echo "Adding Artifactory NuGet source..."
    nuget sources Remove -Name "Artifactory" || echo "No existing source to remove"
    nuget sources Add -Name "Artifactory" `
                      -Source "$(ARTIFACTORY_URL)" `
                      -Username "$(ARTIFACTORY_USERNAME)" `
                      -Password "$(ARTIFACTORY_APIKEY)" `
                      -StorePasswordInClearText
    nuget sources List
  displayName: 'Configure NuGet credentials for Artifactory'

- task: NuGetCommand@2
  displayName: 'Restore NuGet Packages from Artifactory'
  inputs:
    command: 'restore'
    restoreSolution: '**/*.sln'
    feedsToUse: 'config'
